% BODY AXES DERIVATIVES
%  ---------------------------------------------------------------
%  Vortex Lattice Output -- Total Forces
% 
%  Configuration: VTOL                                                        
%      # Surfaces =   6
%      # Strips   =  66
%      # Vortices = 608
% 
%   Sref = 0.66170       Cref = 0.24200       Bref =  2.5000    
%   Xref = 0.49400       Yref =  0.0000       Zref =-0.43000E-01
% 
%  Standard axis orientation,  X fwd, Z down         
% 
%  Run case: cruise                                  
% 
%   Alpha =   2.67998     pb/2V =   0.00000     p'b/2V =   0.00000
%   Beta  =   0.00000     qc/2V =   0.00000
%   Mach  =     0.000     rb/2V =   0.00000     r'b/2V =   0.00000
% 
%   CXtot =   0.01234     Cltot =   0.00000     Cl'tot =   0.00000
%   CYtot =  -0.00000     Cmtot =   0.00000
%   CZtot =  -0.66647     Cntot =   0.00000     Cn'tot =   0.00000
% 
%   CLtot =   0.66632
%   CDtot =   0.01884
%   CDvis =   0.00000     CDind =   0.01884
%   CLff  =   0.66725     CDff  =   0.02048    | Trefftz
%   CYff  =  -0.00000         e =    0.7325    | Plane  
%  
%    aileron         =   0.00001
%    elevator        = -14.25802
%    rudder          =   0.00000
%  
%  ---------------------------------------------------------------
% 
%  Geometry-axis derivatives...
% 
%                     axial   vel. u     sideslip vel. v      normal  vel. w
%                   ----------------    ----------------    ----------------
%  x force CX  |    CXu =  -0.007928    CXv =   0.000000    CXw =   0.697062
%  y force CY  |    CYu =   0.000000    CYv =  -0.354667    CYw =   0.000000
%  z force CZ  |    CZu =  -1.111654    CZv =   0.000000    CZw =  -4.758683
%  x mom.  Cl  |    Clu =  -0.000000    Clv =  -0.035566    Clw =  -0.000000
%  y mom.  Cm  |    Cmu =   0.071554    Cmv =   0.000000    Cmw =  -1.528646
%  z mom.  Cn  |    Cnu =   0.000000    Cnv =   0.114968    Cnw =   0.000000
% 
%                       roll rate  p       pitch rate  q         yaw rate  r
%                   ----------------    ----------------    ----------------
%  x force CX  |    CXp =  -0.000000    CXq =   0.276028    CXr =  -0.000000
%  y force CY  |    CYp =   0.125594    CYq =   0.000000    CYr =   0.281316
%  z force CZ  |    CZp =  -0.000000    CZq =  -8.423907    CZr =   0.000000
%  x mom.  Cl  |    Clp =  -0.473468    Clq =  -0.000000    Clr =   0.146269
%  y mom.  Cm  |    Cmp =  -0.000000    Cmq = -13.289383    Cmr =   0.000000
%  z mom.  Cn  |    Cnp =  -0.094420    Cnq =   0.000000    Cnr =  -0.094406
% 
%                   aileron      d1     elevator     d2     rudder       d3 
%                   ----------------    ----------------    ----------------
%  x force CX  |   CXd1 =  -0.000000   CXd2 =   0.000179   CXd3 =  -0.000000
%  y force CY  |   CYd1 =  -0.000564   CYd2 =   0.000000   CYd3 =   0.005574
%  z force CZ  |   CZd1 =   0.000000   CZd2 =  -0.006286   CZd3 =  -0.000000
%  x mom.  Cl  |   Cld1 =   0.004904   Cld2 =  -0.000000   Cld3 =  -0.000149
%  y mom.  Cm  |   Cmd1 =   0.000000   Cmd2 =  -0.021385   Cmd3 =   0.000000
%  z mom.  Cn  |   Cnd1 =   0.000237   Cnd2 =   0.000000   Cnd3 =  -0.001972

% STABILITY AXES DERIVATIVES
%  ---------------------------------------------------------------
%  Vortex Lattice Output -- Total Forces
% 
%  Configuration: VTOL                                                        
%      # Surfaces =   6
%      # Strips   =  66
%      # Vortices = 608
% 
%   Sref = 0.66170       Cref = 0.24200       Bref =  2.5000    
%   Xref = 0.49400       Yref =  0.0000       Zref =-0.43000E-01
% 
%  Standard axis orientation,  X fwd, Z down         
% 
%  Run case: cruise                                  
% 
%   Alpha =   2.67998     pb/2V =   0.00000     p'b/2V =   0.00000
%   Beta  =   0.00000     qc/2V =   0.00000
%   Mach  =     0.000     rb/2V =   0.00000     r'b/2V =   0.00000
% 
%   CXtot =   0.01234     Cltot =   0.00000     Cl'tot =   0.00000
%   CYtot =  -0.00000     Cmtot =   0.00000
%   CZtot =  -0.66647     Cntot =   0.00000     Cn'tot =   0.00000
% 
%   CLtot =   0.66632
%   CDtot =   0.01884
%   CDvis =   0.00000     CDind =   0.01884
%   CLff  =   0.66725     CDff  =   0.02048    | Trefftz
%   CYff  =  -0.00000         e =    0.7325    | Plane  
%  
%    aileron         =   0.00001
%    elevator        = -14.25802
%    rudder          =   0.00000
%  
%  ---------------------------------------------------------------
% 
%  Stability-axis derivatives...
% 
%                              alpha                beta
%                   ----------------    ----------------
%  z' force CL |    CLa =   4.710093    CLb =  -0.000000
%  y  force CY |    CYa =  -0.000000    CYb =  -0.354667
%  x' mom.  Cl'|    Cla =  -0.000000    Clb =  -0.030152
%  y  mom.  Cm |    Cma =  -1.530320    Cmb =   0.000000
%  z' mom.  Cn'|    Cna =   0.000000    Cnb =   0.116505
% 
%                      roll rate  p'      pitch rate  q'        yaw rate  r'
%                   ----------------    ----------------    ----------------
%  z' force CL |    CLp =   0.000000    CLq =   8.427601    CLr =  -0.000000
%  y  force CY |    CYp =   0.138610    CYq =   0.000000    CYr =   0.275136
%  x' mom.  Cl'|    Clp =  -0.470217    Clq =  -0.000000    Clr =   0.163860
%  y  mom.  Cm |    Cmp =  -0.000000    Cmq = -13.289383    Cmr =   0.000000
%  z' mom.  Cn'|    Cnp =  -0.076829    Cnq =   0.000000    Cnr =  -0.097657
% 
%                   aileron      d1     elevator     d2     rudder       d3 
%                   ----------------    ----------------    ----------------
%  z' force CL |   CLd1 =  -0.000000   CLd2 =   0.006288   CLd3 =   0.000000
%  y  force CY |   CYd1 =  -0.000564   CYd2 =   0.000000   CYd3 =   0.005574
%  x' mom.  Cl'|   Cld1 =   0.004904   Cld2 =  -0.000000   Cld3 =  -0.000149
%  y  mom.  Cm |   Cmd1 =   0.000000   Cmd2 =  -0.021385   Cmd3 =   0.000000
%  z' mom.  Cn'|   Cnd1 =   0.000237   Cnd2 =   0.000000   Cnd3 =  -0.001972
%  Trefftz drag| CDffd1 =   0.000000 CDffd2 =  -0.000519 CDffd3 =   0.000000
%  span eff.   |    ed1 =  -0.000000    ed2 =   0.032274    ed3 =  -0.000000
%  
%  
% 
%  Neutral point  Xnp =   0.572626
% 
%  Clb Cnr / Clr Cnb  =   0.154241    (  > 1 if spirally stable )


% Longitudinal coeffs
% Note that these should be calculated away from trim!
alpha_trim = 3 / 180 * pi;

c_L_0_abs = 0.46517; % Found from run case with zero aoa. Assuming aoa
% runs from 0, without any trim values.

c_L_alpha = 4.710093;
c_L_0 = c_L_0_abs + alpha_trim * c_L_alpha; % c_L_0 as function of delta_alpha = alpha - alpha_trim
c_L_alpha_sq = 0; % AVL only does first order expansion
c_L_q_hat = 8.427601;
c_L_delta_e = 0.006288 * 180 / pi;
c_L = [c_L_0 c_L_alpha c_L_alpha_sq c_L_q_hat c_L_delta_e 0]';

c_D_alpha = 0; % No drag estimate in AVL
c_D_alpha_sq = 0; % AVL only does first order expansion
c_D_q_hat = 0; % No drag estimate in AVL
c_D_delta_e = -0.000519 * 180 / pi; % Trefftz drag
c_D = [0 c_D_alpha c_D_alpha_sq c_D_q_hat c_D_delta_e 0]';

c_m_alpha = -1.530320; % No drag estimate in AVL
c_m_alpha_sq = 0; % AVL only does first order expansion
c_m_q_hat = -13.289383;
c_m_delta_e = -0.021385 * 180 / pi; % Trefftz drag
c_m = [0 c_m_alpha c_m_alpha_sq c_m_q_hat c_m_delta_e 0]';

avl_coeffs_lon = [c_D c_L c_m];

% c_X_u_hat = -0.007928;
% c_X_w_hat = 0.697062;
% c_X_q_hat = 0.276028;
% c_X_delta_e = 0.000179 * 180 / pi;
% c_X = [0 c_X_u_hat c_X_w_hat c_X_q_hat c_X_delta_e]';
% 
% c_Z_u_hat = -1.111654;
% c_Z_w_hat = -4.758683;
% c_Z_q_hat = -8.423907;
% c_Z_delta_e = -0.006286 * 180 / pi;
% c_Z = [0 c_Z_u_hat c_Z_w_hat c_Z_q_hat c_Z_delta_e]';
% 
% c_m_u_hat = 0.071554;
% c_m_w_hat = -1.528646;
% c_m_q_hat = -13.289383;
% c_m_delta_e = -0.021385 * 180 / pi; 
% c_m = [0 c_m_u_hat c_m_w_hat c_m_q_hat c_m_delta_e]';
% 
% avl_coeffs_lon = [c_X c_Z c_m];
save("avl_model/avl_results/avl_coeffs_lon.mat", "avl_coeffs_lon");

% Lateral coeffs
c_Y_v_hat = -0.354667;
c_Y_p_hat = 0.125594;
c_Y_r_hat = 0.281316;
c_Y_delta_a = -0.000564 * 180 / pi;
c_Y_delta_r = 0.005574  * 180 / pi;
c_Y = [0 c_Y_v_hat c_Y_p_hat c_Y_r_hat c_Y_delta_a c_Y_delta_r]';

c_l_v_hat = -0.035566;
c_l_p_hat = -0.473468;
c_l_r_hat = 0.146269;
c_l_delta_a = 0.004904 * 180 / pi;
c_l_delta_r = -0.000149 * 180 / pi;
c_l = [0 c_l_v_hat c_l_p_hat c_l_r_hat c_l_delta_a c_l_delta_r]';

c_n_v_hat = 0.114968;
c_n_p_hat = -0.094420;
c_n_r_hat = -0.094406;
c_n_delta_a = 0.000237 * 180 / pi;
c_n_delta_r = -0.001972 * 180 / pi;
c_n = [0 c_n_v_hat c_n_p_hat c_n_r_hat c_n_delta_a c_n_delta_r]';

avl_coeffs_lat = [c_Y c_l c_n];

save("avl_model/avl_results/avl_coeffs_lat.mat", "avl_coeffs_lat");

